# 设计模式



### 单例模式

```c++
class MyCAS {
  private:
  	MyCAS() {}; // 私有化构造函数，使之不能单独实例化！
  	static MyCAS* m_instance;
  
  public:
    class CAutoRelease { // 类中套类，用来释放对象
      public: 
        ~CAutoRelease() // 类的析构函数中释放
        {
          if (MyCAS::m_instance)
          {
            delete m_instance;
            m_instance = NULL;
          }
        }
    }

  	static GetInstance(){
      if (m_instance == NULL) { // 解决性能问题：后面每次获取单例时不用lock
        std::unique_lock<mutex> mymutex(m_mutex1); // 自动加锁，解决首次生成时的线程安全问题
				if (m_instance == NULL) {
  	      m_instance = new MyCAS();
    	    static CAutoRelease ar; // 生命周期一直到程序退出
      	}
      }
      return m_instance;
    }
}
```



