# TCP/IP



## 名词解释



### RTT

Round Trip Time，网络往返时间，有三部分组成：

1. 链路的传播时间（propagation delay)
2. 末端系统的处理时间
3. 路由器缓存中的排队和处理时间（queuing delay）

其中，前两个部分的值对于一个TCP连接是相对固定的，后一个会随着整个网络拥塞程度的变化而变化。所以RTT的变化在一定程度上反映了网络的拥塞程度。



## 

### RTO

Retransmission TimeOut，重传超时时间。

TCP超时与重传中一个很重要的部分是对一个给定链接的RTT的测量。由于网络流量的变化，这个时间会相应地发生改变，TCP需要跟踪这些变化并动态调整超时时间RTO。



### MSL

Max Survive Live 最大报文段生存时间





## LFN长肥网络

带宽延迟积很大的网络叫做长肥网络。在LFN中建立的TCP链接叫做长肥管道。一个链接的时延带宽积可表示为：

```
capaticy(b) = bandwidth(b/s)xround-triptime(s)
```

具有打的带宽时延积的网络被称为长肥网络。其中存在很多问题：

1. TCP的窗口大小为16bit，即65535字节。这就将发送方发送但未被确认的数据的总长度限制到了65535字节。对于LFN管道，这可能会出现所有的数据还未到达接收方，但是发送方已受限于窗口大小而不能继续发送的情形。这就极大的降低了网络的吞吐量。

   >  扩大窗口选项可以解决这个问题

2. 根据TCP的拥塞控制，丢失分组会导致链接进行拥塞控制，即便是由于冗余ACK而进入了快速恢复，也会使得拥塞窗口降低一半，而如果是由于超时进入了慢启动，这回导致网络吞吐量降低。

   > 选择确认（SACK）可以用来部分避免该问题，采用该技术使得接收方可以有选择的对无序到达的报文段进行确认，而不是采用累积确认，这样被确认的报文段就不会超时，也不会有冗余的ACK。

3. 在LFN中，需要高的RTT测量机制。

4. TCP对每个字节数据使用一个32bit无符号的序号来进行标识。TCP定义了MSL，在LFN中，由于序号空间有限，在已经传输了4294967296个字节以后序号会被重用。如果网络快到在不到一个MSL的时候序号就发生了回绕，网络中就会有两个相同序号的不同的报文段，接收方将无法区分它们的顺序。（在一个千网络中只需要34秒就可以完成4294967296个字节的发送）。

   > 使用TCP的时间戳选项的PAWS(ProtectionAgainstWrappedSequencenumbers)算法（**保护回绕的序号**）可以解决该问题。



## 参考资料

- [TCP中RTT的测量和RTO的计算](https://blog.csdn.net/zhangskd/article/details/7196707)

- [长肥管道](https://baike.baidu.com/item/%E9%95%BF%E8%82%A5%E7%AE%A1%E9%81%93/10679040?fr=aladdin)

